@mixin pips($color,$direction: "to bottom") {

    $gradient: $color, $color 1px, transparent 1px,transparent 1%;
    @for $i from 1 through 100 {
        $dump: ();

        $dump:  $color + ' '+ $i+'%, ' + $color +' calc('+$i+'% + 1px),transparent calc('+$i+'% + 1px),transparent '+($i+1)+'%';


        $gradient: join($gradient, unquote($dump), comma);
    }

    background: linear-gradient(unquote($direction), $gradient);
}

.fader-container {
    width:100rem;
    min-height: 200rem;
    height:100%;

    --color-pips:var(--color-text-fade);

    &.align-right .fader-wrapper {
        .fader {
            margin-left:calc(50% + 15rem);
            &:before {
                box-shadow: 20rem 0 0 35rem;
            }
        }
        .meter-container {
            -webkit-mask:none;
            right:auto!important;
            width:1rem;
        }
    }
    &.align-left .fader-wrapper {
        .fader {
            margin-right:calc(50% + 15rem);
            &:before {
                box-shadow: -20rem 0 0 35rem;
            }
        }
        .meter-container {
            -webkit-mask:none;
            left:auto!important;
            width:1rem;
        }
    }

    .input {
        margin-top:-5rem;
    }

    .fader-wrapper-outer {
        display: flex;
        flex-direction: column;
        flex:1;
    }

    .fader-wrapper {
        padding:20rem;
        flex:1;
        overflow:hidden;
        position: relative;
        display: flex;
        flex-direction: column;
        cursor: -webkit-grab;
        &:active {
            cursor: -webkit-grabbing;
        }
        .fader {
            width:4rem;
            position: relative;
            margin:0 auto;
            pointer-events: none;
            flex:1;
            &:before {
                content:"";
                width:100%;
                height:100%;
                background:var(--color-track);
                z-index: 1;
                display:block;
                box-shadow: 0 0 0 15rem;
                color: var(--color-fg);
                position: absolute;
            }
            .handle {
                position: absolute;
                bottom:0!important;
                top:auto!important;
                width:100%;
                height:100%;
                transform-origin: bottom;
                max-height:100%;
                max-width:100%;
                background:var(--color-accent);
                z-index: 3;
                transform-style: preserve-3d;
                backface-visibility: hidden;
                span {
                    position: absolute;
                    bottom:0;
                    top:0;
                    width:100%;
                    height:100%;
                    transform-origin: top;
                    backface-visibility: hidden;
                }
                span:before {
                    content:"";
                    position: absolute;
                    top:-4rem;
                    left:-2rem;
                    height:8rem;
                    width:8rem;
                    background:var(--color-accent);
                    border:none!important;
                    border-radius: 100%!important;
                }
                span:after {
                    content:"";
                    position: absolute;
                    top:-10rem;
                    left:-8rem;
                    height:20rem;
                    width:20rem;
                    border:none!important;
                    border-radius: 100%!important;
                    background:var(--color-accent);
                    opacity: .2;
                }
            }
            .meter-container {
                position: absolute;
                z-index: 2;
                left:-12rem;
                right:-12rem;
                bottom:0;
                top:0;
                min-width: 0;
                min-height: 0;
                border:0;
                box-shadow: none;
                -webkit-mask:linear-gradient(to right,#000 1rem, rgba(0,0,0,0) 1rem, rgba(0,0,0,0) 27rem, #000 27rem);
                opacity:0.75;
                height:auto;
                .meter {
                    margin:0;
                }
            }
        }

        .pips {
            position: absolute;
            top:0;
            bottom:0;
            left:50%;
            z-index: 0;
            width: 38rem;
            margin-left: -19rem;
            @include pips(var(--color-pips));

            .pip {
                height:1px;
                background: var(--color-pips);
                color:var(--color-fg);
                box-shadow: 0 0 0 1px;
                position: absolute;
                width:44rem;
                margin-left:-3rem;
                span {
                    position: absolute;
                    width:30rem;
                    display: block;
                    text-align: center;
                    font-size:11rem;
                    line-height: 12rem;
                    left:44rem;
                    top:-5.5rem;
                    color:var(--color-pips);
                    &:last-child {
                        left:auto;
                        right:44rem;
                    }
                }
            }
        }
    }
}


.fader-container.horizontal {
    min-height: 80rem;
    height: auto;
    width:300rem;
    flex-shrink: 0;
    .fader-wrapper-outer {
        position: relative;
        top:auto;
        justify-content: center;
        overflow: hidden;

        .fader-wrapper {
            padding:20rem 20rem 35rem;
            display: block;
            flex:0;
            flex-shrink: 0;
        }
        .fader {
            width:100%;
            left:auto;
            top:50%;
            height:4rem;
            &:before {
                box-shadow:none;
            }
            .handle {
                height:100%important;
                width:100%;
                transform-origin: left;
                span {
                    transform-origin: right;
                }
                span:before {
                    top:-2rem;
                    right:-4rem;
                    left:auto;
                }
                span:after {
                    top:-8rem;
                    right:-10rem;
                    left:auto
                }
            }
            .meter-container {
                top:-12rem;
                left:0;
                right:0;
                bottom:auto;
                height:1rem;
                min-width: 0;
                min-height: 0;
                box-shadow: none;
                -webkit-mask:none;
            }
        }
        .pips {
            top:15rem;left:0;
            right:0;
            font-size: 0;
            height:4rem;
            width:100%;
            margin:0;
            @include pips(var(--color-pips),'to left');
        }
        .pip {
            width:1px;
            height:6rem;
            margin: 0;

            span {
                top:15rem;
                left:-15rem!important;
                right:auto;
            }
        }
    }
}
